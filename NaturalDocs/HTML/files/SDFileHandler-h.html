<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>SDFileHandler.h</title><link rel="stylesheet" type="text/css" href="../styles/main.css" /><script type="text/javascript" src="../styles/main.js"></script><script type="text/javascript">NDLoader.LoadJS("Content", "../styles/");</script></head>

<!-- Generated by Natural Docs, version 2.0.2 -->

<!-- saved from url=(0016)http://localhost -->

<body onload="NDLoader.OnLoad('Content');" class="NDPage NDContentPage">

<a name="Information"></a><a name="Topic6"></a><div class="CTopic TGroup LC first">
 <div class="CTitle">Information</div>
</div>

<a name="SDFileHandler_Class"></a><a name="Topic13"></a><div class="CTopic TInformation LC">
 <div class="CTitle">SDFileHandler Class</div>
 <div class="CBody"><p>The standard SD File handling code is <u>borked</u> on Arduino.&nbsp; This is an effort to get around that problem - these problems actually!</p><table class="CDefinitionList"><tr><td class="CDLEntry">FILE_WRITE</td><td class="CDLDefinition"><p>opens the file in APPEND mode, not WRITE. That is configured deliberately in the source. This &quot;library&quot; gets around that and FILE_WRITE will open at the start of the file. FILE_APPEND will replicate the existing FILE_WRITE behaviour.</p></td></tr><tr><td class="CDLEntry">write()</td><td class="CDLDefinition"><p>only ever writes a single byte to the SD Card when used to write, say, an int or a float etc. It works perfectly when passed an array and a size.</p></td></tr></table><p>This class ensures that a <a href="../index.html#File:SDFileHandler.h:write" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,14);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >write</a> with a single parameter will indeed write the full length of the data.</p><p><b>Norman Dunbar</b></p><p><b>31st August 2020.</b></p></div>
</div>

<a name="Functions"></a><a name="Topic1"></a><div class="CTopic TGroup LC">
 <div class="CTitle">Functions</div>
</div>

<a name="SDFileHandler"></a><a name="Topic5"></a><div class="CTopic TFunction LC">
 <div class="CTitle">SDFileHandler</div>
 <div id="NDPrototype5" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters">SDFileHandler(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PModifierQualifier first"><span class="SHKeyword">const</span>&nbsp;</td><td class="PType"><span class="SHKeyword">char</span>&nbsp;</td><td class="PNamePrefix">*</td><td class="PName">fileName,</td><td></td><td class="last"></td></tr><tr><td class="first"></td><td class="PType">uint8_t&nbsp;</td><td></td><td class="PName">openMode&nbsp;</td><td class="PDefaultValueSeparator">=&nbsp;</td><td class="PDefaultValue last">FILE_READ</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>The constructor assumes that the SD Card system has already been initialised and that no files are open.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">fileName<div class="CDLParameterType"><span class="SHKeyword">const</span> <span class="SHKeyword">char</span>*</div></td><td class="CDLDefinition"><p>the file name which will be opened.</p></td></tr><tr><td class="CDLEntry">openMode<div class="CDLParameterType">uint8_t</div></td><td class="CDLDefinition"><p>the mode in which the file will be opened.&nbsp; The default is FILE_READ for reading only.</p></td></tr></table><div class="CHeading">Open Modes</div><table class="CDefinitionList"><tr><td class="CDLEntry">FILE_READ</td><td class="CDLDefinition"><p>open the file for reading only. The file must already exist.</p></td></tr><tr><td class="CDLEntry">FILE_WRITE</td><td class="CDLDefinition"><p>opens the file at the start and overwrites anything already there. The file will be created if it does not exist.</p></td></tr><tr><td class="CDLEntry">FILE_APPEND</td><td class="CDLDefinition"><p>opens the file for writing. Existing contents remain untouched and new data is added at the end.</p></td></tr></table><p>If a file is to be opened for reading, it must exist on the SD Card. If the file is being opened for writing, in either of the two modes, it will be created if it doesn't already exist.</p></div>
</div>

<a name="SDFileHandler(2)"></a><a name="Topic2"></a><div class="CTopic TFunction LC">
 <div class="CTitle">SDFileHandler</div>
 <div id="NDPrototype2" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters">SDFileHandler(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first">String&nbsp;</td><td class="PName">fileName,</td><td></td><td class="last"></td></tr><tr><td class="PType first">uint8_t&nbsp;</td><td class="PName">openMode&nbsp;</td><td class="PDefaultValueSeparator">=&nbsp;</td><td class="PDefaultValue last">FILE_READ</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>This constructor takes the same parameters as above, but the filename is an Arduino String in this case.</p></div>
</div>

<a name="~SDFileHandler"></a><a name="Topic7"></a><div class="CTopic TFunction LC">
 <div class="CTitle">~SDFileHandler</div>
 <div id="NDPrototype7" class="NDPrototype NoParameterForm">~SDFileHandler()</div>
 <div class="CBody"><p>Closes down any opened files before the object goes out of scope.</p></div>
</div>

<a name="reOpen"></a><a name="Topic10"></a><div class="CTopic TFunction LC">
 <div class="CTitle">reOpen</div>
 <div id="NDPrototype10" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters"><span class="SHKeyword">void</span> reOpen(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first">uint8_t&nbsp;</td><td class="PName last">openMode</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Given an open file, close it, then reopen it in the specified mode.</p><div class="CHeading">Parameter</div><table class="CDefinitionList"><tr><td class="CDLEntry">openMode<div class="CDLParameterType">uint8_t</div></td><td class="CDLDefinition"><p>is the new mode in which the file should be re-opened.</p></td></tr></table><div class="CHeading">Open Modes</div><table class="CDefinitionList"><tr><td class="CDLEntry">FILE_READ</td><td class="CDLDefinition"><p>open the file for reading only. The file must already exist.</p></td></tr><tr><td class="CDLEntry">FILE_WRITE</td><td class="CDLDefinition"><p>opens the file at the start and overwrites anything already there. The file will be created if it does not exist.</p></td></tr><tr><td class="CDLEntry">FILE_APPEND</td><td class="CDLDefinition"><p>opens the file for writing. Existing contents remain untouched and new data is added at the end.</p></td></tr></table><p>If a file is to be opened for reading, it must exist on the SD Card. If the file is being opened for writing, in either of the two modes, it will be created if it doesn't already exist.</p></div>
</div>

<a name="close"></a><a name="Topic11"></a><div class="CTopic TFunction LC">
 <div class="CTitle">close</div>
 <div id="NDPrototype11" class="NDPrototype NoParameterForm"><span class="SHKeyword">void</span> close()</div>
 <div class="CBody"><p>Close a file. There are no parameters as the file handle held in <a href="../index.html#File:SDFileHandler.h:theFile" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,8);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >theFile</a> will be closed.</p></div>
</div>

<a name="getHandle"></a><a name="Topic4"></a><div class="CTopic TFunction LC">
 <div class="CTitle">getHandle</div>
 <div id="NDPrototype4" class="NDPrototype NoParameterForm">File getHandle()</div>
 <div class="CBody"><p>Return a handle to the underlying File which is stored internally in <a href="../index.html#File:SDFileHandler.h:theFile" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,8);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >theFile</a>. The returned handle can be used to call underlying File functions such as <b>position</b> and <b>seek</b> etc.</p></div>
</div>

<a name="write"></a><a name="Topic14"></a><div class="CTopic TFunction LC">
 <div class="CTitle">write</div>
 <div id="NDPrototype14" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters">size_t write(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first"><span class="SHKeyword">byte</span>&nbsp;</td><td class="PName last">data</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Various write functions to correct the borked stuff in the Arduino File implementation. The write function is overloaded to allow the following data types to be written to a file:</p><table class="CDefinitionList"><tr><td class="CDLEntry">byte</td><td class="CDLDefinition"><p>1 byte.</p></td></tr><tr><td class="CDLEntry">short</td><td class="CDLDefinition"><p>2 bytes little endian.</p></td></tr><tr><td class="CDLEntry">int</td><td class="CDLDefinition"><p>2 bytes little endian.</p></td></tr><tr><td class="CDLEntry">long</td><td class="CDLDefinition"><p>4 bytes little endian.</p></td></tr><tr><td class="CDLEntry">float</td><td class="CDLDefinition"><p>4 bytes.</p></td></tr><tr><td class="CDLEntry">char *</td><td class="CDLDefinition"><p>all the bytes in the string, plus the zero byte at the end.</p></td></tr></table><div class="CHeading">Returns</div><p>All write functions return the number of bytes written.</p><div class="CHeading">See Also</div><p><a href="../index.html#File:SDFileHandler.h:writeData" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,15);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >writeData</a></p></div>
</div>

<a name="writeData"></a><a name="Topic15"></a><div class="CTopic TFunction LC">
 <div class="CTitle">writeData</div>
 <div id="NDPrototype15" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters">size_t SDFileHandler::writeData(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first">uint8_t&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">data,</td></tr><tr><td class="PType first">uint32_t&nbsp;</td><td></td><td class="PName last">dataLength</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Write arbitrary data to the SD Card file. The data written is preceeded by a long (4 bytes) word containing the size of the following data. There is no terminator byte.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">data<div class="CDLParameterType">uint8_t*</div></td><td class="CDLDefinition"><p>A pointer to the start of the data to be written.</p></td></tr><tr><td class="CDLEntry">dataLength<div class="CDLParameterType">uint32_t</div></td><td class="CDLDefinition"><p>the size of the data to be written.</p></td></tr></table><div class="CHeading">Returns</div><p>The number of bytes written, plus 4, is returned.</p><div class="CHeading">See Also</div><p><a href="../index.html#File:SDFileHandler.h:write" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,14);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >write</a></p></div>
</div>

<a name="readByte"></a><a name="Topic16"></a><div class="CTopic TFunction LC">
 <div class="CTitle">readByte</div>
 <div id="NDPrototype16" class="NDPrototype NoParameterForm"><span class="SHKeyword">byte</span> readByte()</div>
 <div class="CBody"><p>Returns one byte from the SD Card file.</p></div>
</div>

<a name="readShort"></a><a name="Topic17"></a><div class="CTopic TFunction LC">
 <div class="CTitle">readShort</div>
 <div id="NDPrototype17" class="NDPrototype NoParameterForm"><span class="SHKeyword">short</span> readShort()</div>
 <div class="CBody"><p>Returns a pair of bytes, into a short variable, from the SD Card file.</p></div>
</div>

<a name="readInt"></a><a name="Topic18"></a><div class="CTopic TFunction LC">
 <div class="CTitle">readInt</div>
 <div id="NDPrototype18" class="NDPrototype NoParameterForm"><span class="SHKeyword">int</span> readInt()</div>
 <div class="CBody"><p>Returns a pair of bytes, into an int variable, from the SD Card file.</p></div>
</div>

<a name="readLong"></a><a name="Topic19"></a><div class="CTopic TFunction LC">
 <div class="CTitle">readLong</div>
 <div id="NDPrototype19" class="NDPrototype NoParameterForm"><span class="SHKeyword">long</span> readLong()</div>
 <div class="CBody"><p>Returns 4 bytes, into a long variable, from the SD Card file.</p></div>
</div>

<a name="readFloat"></a><a name="Topic20"></a><div class="CTopic TFunction LC">
 <div class="CTitle">readFloat</div>
 <div id="NDPrototype20" class="NDPrototype NoParameterForm"><span class="SHKeyword">float</span> readFloat()</div>
 <div class="CBody"><p>Returns 4 bytes, into a float variable, from the SD Card file.</p></div>
</div>

<a name="readData"></a><a name="Topic21"></a><div class="CTopic TFunction LC">
 <div class="CTitle">readData</div>
 <div id="NDPrototype21" class="NDPrototype WideForm CStyle"><table><tr><td class="PBeforeParameters">uint32_t readData(</td><td class="PParametersParentCell"><table class="PParameters"><tr><td class="PType first">uint8_t&nbsp;</td><td class="PNamePrefix">*</td><td class="PName last">buffer,</td></tr><tr><td class="PType first">uint32_t&nbsp;</td><td></td><td class="PName last">bufferLength</td></tr></table></td><td class="PAfterParameters">)</td></tr></table></div>
 <div class="CBody"><p>Returns a number of bytes, into an existing buffer, from the SD Card file.</p><div class="CHeading">Parameters</div><table class="CDefinitionList"><tr><td class="CDLEntry">buffer<div class="CDLParameterType">uint8_t*</div></td><td class="CDLDefinition"><p>the address of the buffer where the data will be written to. It must be large enough to hold the data being read plus, if necessary, a terminator.</p></td></tr><tr><td class="CDLEntry">bufferLength<div class="CDLParameterType">uint32_t</div></td><td class="CDLDefinition"><p>the number of bytes to be read into the buffer.</p></td></tr></table></div>
</div>

<a name="Variables"></a><a name="Topic3"></a><div class="CTopic TGroup LC">
 <div class="CTitle">Variables</div>
</div>

<a name="theFile"></a><a name="Topic8"></a><div class="CTopic TVariable LC">
 <div class="CTitle">theFile</div>
 <div id="NDPrototype8" class="NDPrototype NoParameterForm">File theFile</div>
 <div class="CBody"><p>This <b>private</b> variable holds onto the underlying File handle. It is used internally and cannot be accessed except by calling <a href="../index.html#File:SDFileHandler.h:getHandle" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,4);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >getHandle</a>.</p></div>
</div>

<a name="theFileName"></a><a name="Topic9"></a><div class="CTopic TVariable LC last">
 <div class="CTitle">theFileName</div>
 <div id="NDPrototype9" class="NDPrototype NoParameterForm"><span class="SHKeyword">char</span> *theFileName</div>
 <div class="CBody"><p>This <b>private</b> variable holds the filename that the file was originally opened with. It will be in 8.3 format. It is only held for use by the <a href="../index.html#File:SDFileHandler.h:reOpen" target="_top" onmouseover="NDContentPage.OnLinkMouseOver(event,10);" onmouseout="NDContentPage.OnLinkMouseOut(event);" >reOpen</a> function, so that a file can, if necessary, be opened for writing then re-opened for reading immediately afterwards.</p></div>
</div>

</body></html>